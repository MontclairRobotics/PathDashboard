<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PATH GUI</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    header {
      background-color: #333;
      color: white;
      padding: 1em;
      text-align: center;
    }
    #app {
      display: flex;
      height: 100vh;
      overflow: hidden;
    }
    #canvas-container {
      flex: 3;
      position: relative;
      background: #f0f0f0;
    }
    canvas {
      display: block;
      border: 1px solid #ccc;
      margin: auto;
    }
    #controls {
      flex: 1;
      padding: 1em;
      background: #eaeaea;
      overflow-y: auto;
    }
    button {
      margin: 0.5em 0;
      padding: 0.5em 1em;
      cursor: pointer;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
    }
    button:hover {
      background: #0056b3;
    }
    #output {
      margin-top: 1em;
      font-family: monospace;
      white-space: pre-wrap;
      background: #fff;
      padding: 0.5em;
      border: 1px solid #ccc;
      border-radius: 4px;
      max-height: 100px;
      overflow-y: auto;
    }
    #waypoint-code {
      margin-top: 1em;
      font-family: monospace;
      white-space: pre-wrap;
      background: #fff;
      padding: 0.5em;
      border: 1px solid #ccc;
      border-radius: 4px;
      max-height: 200px;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <header>
    <h1>Montclair FRC Path GUI</h1>
  </header>
  <div id="app">
    <div id="canvas-container">
      <canvas id="plannerCanvas" width="800" height="600"></canvas>
    </div>
    <div id="controls">
      <h2>Controls</h2>
      <button id="toggle-tweak">Enable Tweaking Mode</button>
      <button id="clear">Clear Selection</button>
      <button id="copy">Copy Path</button>
      <h3>Waypoint Sequence</h3>
      <div id="output"></div>
      <h3>Generated Code for Waypoints</h3>
      <button id="generate-code">Generate Waypoint Code</button>
      <div id="waypoint-code"></div>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('plannerCanvas');
    const ctx = canvas.getContext('2d');
    const output = document.getElementById('output');
    const waypointCode = document.getElementById('waypoint-code');
    const predefinedWaypoints = [
  {
    "id": "A",
    "x": 81,
    "y": 134.125
  },
  {
    "id": "B",
    "x": 104,
    "y": 113.125
  },
  {
    "id": "C",
    "x": 126,
    "y": 92.125
  },
  {
    "id": "D",
    "x": 81,
    "y": 463.125
  },
  {
    "id": "E",
    "x": 100,
    "y": 484.125
  },
  {
    "id": "F",
    "x": 122,
    "y": 506.125
  },
  {
    "id": "G",
    "x": 251,
    "y": 251.125
  },
  {
    "id": "H",
    "x": 268,
    "y": 262.125
  },
  {
    "id": "I",
    "x": 276,
    "y": 287.125
  },
  {
    "id": "J",
    "x": 277,
    "y": 310.125
  },
  {
    "id": "K",
    "x": 268,
    "y": 333.125
  },
  {
    "id": "L",
    "x": 254,
    "y": 349.125
  },
  {
    "id": "M",
    "x": 227,
    "y": 350.125
  },
  {
    "id": "N",
    "x": 213,
    "y": 336.125
  },
  {
    "id": "O",
    "x": 199,
    "y": 309.125
  },
  {
    "id": "P",
    "x": 199,
    "y": 287.125
  },
  {
    "id": "Q",
    "x": 212,
    "y": 259.125
  },
  {
    "id": "R",
    "x": 229,
    "y": 247.125
  },
  {
    "id": "S",
    "x": 354,
    "y": 134.125
  },
  {
    "id": "T",
    "x": 354,
    "y": 191.125
  },
  {
    "id": "U",
    "x": 349,
    "y": 249.125
  },
  {
    "id": "V",
    "x": 353,
    "y": 302.125
  },
  {
    "id": "W",
    "x": 116,
    "y": 206.125
  },
  {
    "id": "X",
    "x": 122,
    "y": 302.125
  },
  {
    "id": "Y",
    "x": 115,
    "y": 395.125
  },
  {
    "id": "Z",
    "x": 335,
    "y": 525.125
  }
];


    let selectedWaypoints = [];
    let tweakingMode = false;
    let draggingWaypoint = null;
    const fieldImage = new Image();

    fieldImage.src = 'https://lh3.googleusercontent.com/pw/AP1GczNS3jp1GGMGcutugRuk_jJedvIXzUh-UtLmJmfoOnhEgrTC6iVNxFFsqYrgR6Oj-hFmqTxG4fMMHV5PVP9dfTklGLayMINvMEM4bFH7WHLBEHw_ZwPw=w600-h315-p-k';
    fieldImage.onload = () => {
      redrawCanvas();
    };

    function drawCircle(x, y, color = 'blue', label = '') {
      ctx.beginPath();
      ctx.arc(x, y, 10, 0, Math.PI * 2);
      ctx.fillStyle = color;
      ctx.fill();
      ctx.closePath();
      if (label) {
        ctx.font = '12px Arial';
        ctx.fillStyle = 'white';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(label, x, y);
      }
    }

    function drawLine(x1, y1, x2, y2) {
      ctx.beginPath();
      ctx.moveTo(x1, y1);
      ctx.lineTo(x2, y2);
      ctx.strokeStyle = 'green';
      ctx.lineWidth = 2;
      ctx.stroke();
      ctx.closePath();
    }

    function redrawCanvas() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(fieldImage, 0, 0, canvas.width, canvas.height);

      for (let i = 0; i < selectedWaypoints.length - 1; i++) {
        const wp1 = predefinedWaypoints.find(wp => wp.id === selectedWaypoints[i]);
        const wp2 = predefinedWaypoints.find(wp => wp.id === selectedWaypoints[i + 1]);
        if (wp1 && wp2) {
          drawLine(wp1.x, wp1.y, wp2.x, wp2.y);
        }
      }

      predefinedWaypoints.forEach(wp => {
        const color = selectedWaypoints.includes(wp.id) ? 'green' : 'blue';
        drawCircle(wp.x, wp.y, color, wp.id);
      });
    }

    function getClickedWaypoint(x, y) {
      return predefinedWaypoints.find(
        wp => Math.hypot(wp.x - x, wp.y - y) <= 10
      );
    }

    function updateOutput() {
      output.textContent = selectedWaypoints.join(' -> ');
    }

    function generateWaypointCode() {
      const code = `const predefinedWaypoints = ${JSON.stringify(predefinedWaypoints, null, 2)};`;
      waypointCode.textContent = code;
    }

    canvas.addEventListener('mousedown', e => {
      if (!tweakingMode) return;
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      draggingWaypoint = getClickedWaypoint(x, y);
    });

    canvas.addEventListener('mousemove', e => {
      if (draggingWaypoint) {
        const rect = canvas.getBoundingClientRect();
        draggingWaypoint.x = e.clientX - rect.left;
        draggingWaypoint.y = e.clientY - rect.top;
        redrawCanvas();
      }
    });

    canvas.addEventListener('mouseup', () => {
      draggingWaypoint = null;
    });

    canvas.addEventListener('click', e => {
      if (tweakingMode) return;
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;

      const clickedWaypoint = getClickedWaypoint(x, y);
      if (clickedWaypoint) {
        selectedWaypoints.push(clickedWaypoint.id);
        redrawCanvas();
        updateOutput();
      }
    });

    document.getElementById('clear').addEventListener('click', () => {
      selectedWaypoints = [];
      redrawCanvas();
      updateOutput();
    });

    document.getElementById('copy').addEventListener('click', () => {
      navigator.clipboard
        .writeText(selectedWaypoints.join(' -> '))
        .then(() => alert('Path copied!'))
        .catch(() => alert('Failed to copy!'));
    });

    document.getElementById('toggle-tweak').addEventListener('click', () => {
      tweakingMode = !tweakingMode;
      alert(tweakingMode ? 'Tweaking mode enabled' : 'Tweaking mode disabled');
    });

    document.getElementById('generate-code').addEventListener('click', generateWaypointCode);

    redrawCanvas();
  </script>
</body>
</html>
